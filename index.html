<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Tam Thi√™n" />
    <meta name="theme-color" content="#667eea" />
    <meta name="description" content="Tr√≤ Ch∆°i K·ªÉ Chuy·ªán T∆∞∆°ng T√°c V·ªõi AI - Tam Thi√™n Th·∫ø Gi·ªõi" />
    
    <title>Tam Thi√™n Th·∫ø Gi·ªõi - AI Storytelling Game</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json" />
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="./icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="./icons/icon-192x192.png" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-72x72.png" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Rajdhani:wght@600;700&family=Cinzel+Decorative:wght@700&family=Source+Serif+Pro:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
      :root, [data-theme="dark"] {
        --bg-main: #1a1a1a;
        --text-main: #e0e0e0;
        --text-secondary: #a0a0a0;
        --font-body: 'Inter', sans-serif;
        --font-header: 'Rajdhani', sans-serif;
        --font-title-family: 'Cinzel Decorative', serif;

        --cursor-light-color: rgba(200, 200, 200, 0.03);

        /* Neumorphic Shadows */
        --shadow-color-1: #141414;
        --shadow-color-2: #202020;
        
        /* Neumorphic Gradients */
        --grad-convex: linear-gradient(145deg, #1c1c1c, #171717);
        --grad-concave: linear-gradient(145deg, #171717, #1c1c1c);

        /* Scrollbar */
        --scrollbar-thumb: #4a4a4a;
        --scrollbar-thumb-hover: #6a6a6a;
        
        /* Button Specific */
        --btn-primary-text: #ffffff;
        --btn-choice-bg: rgba(255, 255, 255, 0.05);
        --btn-choice-hover-bg: rgba(255, 255, 255, 0.1);
        --btn-choice-border: rgba(255, 255, 255, 0.1);
        --btn-choice-hover-border: rgba(255, 255, 255, 0.2);
        --btn-choice-disabled-text: #6b7280;
        --btn-choice-disabled-border: #404040;

        /* Title Specific */
        --title-glow-color-soft: rgba(255, 255, 255, 0.4);
        --title-glow-color-faint: rgba(255, 255, 255, 0.2);

        /* Logo Specific */
        --logo-primary: #ffffff;
        --logo-gradient-start: rgba(255, 255, 255, 0.8);
        --logo-gradient-end: rgba(224, 224, 224, 0.5);
        --logo-glow-filter-color: #ffffff;

        --bg-panel: #262626; /* Panel background */
        --dialogue-color: #9cdcfe; /* Dialogue text color for dark theme */
      }
      [data-theme="sepia"] {
        --bg-main: #f5eeda;
        --text-main: #5d4037;
        --text-secondary: #795548;
        --font-body: 'Source Serif Pro', serif;
        --font-header: 'Rajdhani', sans-serif;
        --font-title-family: 'Cinzel Decorative', serif;

        --cursor-light-color: rgba(93, 64, 55, 0.05);

        /* Flat/Subtle Shadows for Sepia */
        --shadow-color-1: #d3c5a9;
        --shadow-color-2: #ffffff;

        /* Flat Gradients */
        --grad-convex: #ede0c2;
        --grad-concave: #f5eeda;
        
        /* Scrollbar */
        --scrollbar-thumb: #a1887f;
        --scrollbar-thumb-hover: #8d6e63;

        /* Button Specific */
        --btn-primary-text: #f5eeda;
        --btn-choice-bg: rgba(93, 64, 55, 0.05);
        --btn-choice-hover-bg: rgba(93, 64, 55, 0.1);
        --btn-choice-border: rgba(93, 64, 55, 0.1);
        --btn-choice-hover-border: rgba(93, 64, 55, 0.2);
        --btn-choice-disabled-text: #9e9e9e;
        --btn-choice-disabled-border: #d7ccc8;
        
        /* Title Specific */
        --title-glow-color-soft: rgba(93, 64, 55, 0.3);
        --title-glow-color-faint: rgba(93, 64, 55, 0.15);

        /* Logo Specific */
        --logo-primary: var(--text-main);
        --logo-gradient-start: rgba(93, 64, 55, 0.8);
        --logo-gradient-end: rgba(121, 85, 72, 0.5);
        --logo-glow-filter-color: var(--text-main);
        
        --bg-panel: #ede0c2; /* Panel background */
        --dialogue-color: #4a6984; /* Dialogue text color for sepia theme */
      }

      html, body, #root {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      body {
        font-family: var(--font-body);
        background-color: var(--bg-main);
        color: var(--text-main);
        transition: background-color 0.5s ease, color 0.5s ease;
      }
      h1, h2, h3, h4, h5, h6, .font-rajdhani {
        font-family: var(--font-header);
      }
      .font-title {
        font-family: var(--font-title-family);
      }
      /* Custom Scrollbar Styles */
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: var(--scrollbar-thumb);
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background-color: var(--scrollbar-thumb-hover);
      }
      
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at var(--x) var(--y), var(--cursor-light-color), transparent 40vmax);
        z-index: -1;
        pointer-events: none;
        transition: background 0.2s ease-out;
      }
      
      /* Neumorphism Base Classes */
      .neumorphic-flat, .neumorphic-convex, .neumorphic-inset, .neumorphic-concave {
         --shadow-outer: 6px 6px 12px var(--shadow-color-1), -6px -6px 12px var(--shadow-color-2);
         --shadow-inset: inset 6px 6px 12px var(--shadow-color-1), inset -6px -6px 12px var(--shadow-color-2);
      }

      .neumorphic-flat {
        background: var(--bg-main);
        box-shadow: var(--shadow-outer);
      }
      .neumorphic-inset {
        background: var(--bg-main);
        box-shadow: var(--shadow-inset);
      }
      .neumorphic-convex {
        background: var(--grad-convex);
        box-shadow: var(--shadow-outer);
      }
       .neumorphic-concave {
        background: var(--grad-concave);
        box-shadow: var(--shadow-inset);
      }

      /* Button Styles */
      button[data-variant="primary"] {
        color: var(--btn-primary-text);
      }
      button[data-variant="primary"]:hover {
        filter: brightness(1.1);
      }
      button[data-variant="primary"]:active {
        box-shadow: var(--shadow-inset);
        filter: brightness(0.95);
      }

      button[data-variant="secondary"], button[data-variant="guide"] {
        color: var(--text-main);
      }
      button[data-variant="secondary"]:hover, button[data-variant="guide"]:hover {
        filter: brightness(1.1);
      }
      button[data-variant="secondary"]:active, button[data-variant="guide"]:active {
        box-shadow: var(--shadow-inset);
        filter: brightness(0.95);
      }

      button[data-variant="choice"] {
        background-color: var(--btn-choice-bg);
        color: var(--text-main);
        border: 1px solid var(--btn-choice-border);
      }
      button[data-variant="choice"]:hover {
        background-color: var(--btn-choice-hover-bg);
        border-color: var(--btn-choice-hover-border);
      }
      button[data-variant="choice"]:active {
        background-color: var(--btn-choice-hover-bg);
      }
      button[data-variant="choice"]:disabled {
        background-color: transparent;
        color: var(--btn-choice-disabled-text);
        border-color: var(--btn-choice-disabled-border);
      }

      /* GameScreen specific prose overrides */
      .prose .dialogue-text {
        color: var(--dialogue-color);
      }
      
      [data-theme="sepia"] .prose-invert {
        --tw-prose-body: var(--text-main);
        --tw-prose-headings: var(--text-main);
        --tw-prose-lead: var(--text-secondary);
        --tw-prose-bold: var(--text-main);
        --tw-prose-counters: var(--text-secondary);
        --tw-prose-bullets: var(--text-secondary);
        --tw-prose-links: #8d6e63;
        --tw-prose-quotes: var(--text-main);
      }

      /* Theme-aware overrides for common Tailwind utilities on Sepia theme */
      [data-theme="sepia"] .text-white,
      [data-theme="sepia"] .text-neutral-100,
      [data-theme="sepia"] .text-neutral-200 {
        color: var(--text-main);
      }
      
      [data-theme="sepia"] .text-neutral-300,
      [data-theme="sepia"] .text-neutral-400 {
        color: var(--text-secondary);
      }
      
      [data-theme="sepia"] .hover\:text-white:hover {
          color: var(--text-main);
      }
      
      [data-theme="sepia"] .border-white\/10 {
         border-color: rgba(93, 64, 55, 0.2);
      }
      
      [data-theme="sepia"] .focus\:ring-white\/80:focus {
          --tw-ring-color: var(--text-main);
      }
    </style>

  <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.12.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "react/": "https://esm.sh/react@^19.1.1/",
    "react": "https://esm.sh/react@^19.1.1"
  }
}
</script>
  <script type="module" crossorigin src="./assets/index-Bi5YuLfe.js"></script>
</head>
  <body>
    <div id="root"></div>
    
    <!-- Install PWA Prompt -->
    <div id="install-prompt" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--bg-main); padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 1000; max-width: 90%; text-align: center;">
      <p style="margin-bottom: 15px; color: var(--text-main);">üì± C√†i ƒë·∫∑t ·ª©ng d·ª•ng ƒë·ªÉ tr·∫£i nghi·ªám t·ªët h∆°n!</p>
      <button id="install-button" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-right: 10px;">C√†i ƒê·∫∑t</button>
      <button id="dismiss-button" style="background: transparent; color: var(--text-main); padding: 12px 24px; border: 1px solid var(--text-main); border-radius: 8px; cursor: pointer;">ƒê·ªÉ Sau</button>
    </div>
    
    <script>
      // Mouse move effect
      window.addEventListener('mousemove', e => {
          document.body.style.setProperty('--x', e.clientX + 'px');
          document.body.style.setProperty('--y', e.clientY + 'px');
      });
      
      // Register Service Worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js')
            .then(registration => {
              console.log('‚úÖ Service Worker registered:', registration.scope);
            })
            .catch(error => {
              console.log('‚ùå Service Worker registration failed:', error);
            });
        });
      }
      
      // PWA Install Prompt
      let deferredPrompt;
      const installPrompt = document.getElementById('install-prompt');
      const installButton = document.getElementById('install-button');
      const dismissButton = document.getElementById('dismiss-button');
      
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // Show install prompt after 3 seconds
        setTimeout(() => {
          installPrompt.style.display = 'block';
        }, 3000);
      });
      
      installButton.addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response: ${outcome}`);
          deferredPrompt = null;
        }
        installPrompt.style.display = 'none';
      });
      
      dismissButton.addEventListener('click', () => {
        installPrompt.style.display = 'none';
      });
      
      // Log installation success
      window.addEventListener('appinstalled', () => {
        console.log('‚úÖ PWA ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t th√†nh c√¥ng!');
      });
      
      // Handle touch events for mobile
      if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
      }
      
      // Prevent zoom on double tap (iOS)
      let lastTouchEnd = 0;
      document.addEventListener('touchend', (e) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          e.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
    </script>
  </body>
</html>